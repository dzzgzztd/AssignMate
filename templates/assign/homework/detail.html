{% extends "assign/base.html" %}
{% load assign_tags %}

{% block title %}{{ homework.title }}{% endblock %}

{% block content %}
<h1>{{ homework.title }}</h1>
<p class="date">
    Published {{ homework.publish }} by {{ homework.author }}
</p>

{% if request.user == homework.author or request.user.is_staff %}
    <form method="post" action="{% url 'assign:delete_homework' homework.id %}">
    {% csrf_token %}
    <button type="submit">Delete</button>
    </form>
{% endif %}

<p>
    Course: <a href="{% url 'assign:course_detail' pk=homework.course.id %}">{{ homework.course.title }}</a>
</p>
{{ homework.body|markdown }}

{% if homework.pdf %}
    <p><a href="{{ homework.pdf.url }}" target="_blank">Download Attached PDF</a></p>
{% else %}
    <p>No attached PDF.</p>
{% endif %}

<p><a href="{% url 'assign:homework_share' homework.id %}">Share this Homework</a></p>

<h2>Similar homeworks</h2>
{% for homework in similar_homeworks %}
    <p><a href="{{ homework.get_absolute_url }}">{{ homework.title }}</a></p>
{% empty %}
    <p>There are no similar homeworks yet.</p>
{% endfor %}

{% if can_submit_solution and not is_teacher %}
    <button onclick="location.href='{% url 'assign:submit_solution' homework.id %}'">Submit Solution</button>
{% endif %}

{% if solutions %}
    <h3>Submitted Solutions</h3>
    <ul>
    {% for solution in solutions %}
        <li>
            {{ solution.student.username }}'s solution:
            <div>
                <div class="preformatted-text">{{ solution.answer_text|markdown }}</div>
                {% if solution.answer_pdf %}
                    <a href="{{ solution.answer_pdf.url }}">Download PDF</a>
                {% endif %}
                {% if solution.grade or solution.teacher_comment %}
                    <p>Grade: {{ solution.grade|default:"Not graded yet" }}</p>
                    <p>Teacher's Comment: {{ solution.teacher_comment|default:"No comment" }}</p>
                {% endif %}
                {% if is_teacher %}
                    <a href="{% url 'assign:review_homework' solution.id %}">Review Solution</a>
                {% endif %}
            </div>
        </li>
    {% endfor %}
    </ul>
{% else %}
    <p>No solutions submitted yet.</p>
{% endif %}

{% with comments.count as total_comments %}
    <h2>{{ total_comments }} comment{{ total_comments|pluralize }}</h2>
{% endwith %}

{% for comment in comments %}
    <div class="comment">
        <p class="info">Comment {{ forloop.counter }} by {{ comment.name }} on {{ comment.created }}</p>
        {{ comment.body|linebreaks }}
    </div>
{% empty %}
    <p>There are no comments yet.</p>
{% endfor %}
{% include "assign/homework/includes/comment_form.html" %}
{% endblock %}
